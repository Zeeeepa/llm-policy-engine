# Example: PostgreSQL Database Secrets
#
# Usage:
#   1. Update values in this file (host, user, password, etc.)
#   2. Save as postgres-secret.yaml
#   3. Seal: kubeseal -f postgres-secret.yaml -w sealed-postgres-secret.yaml
#   4. Apply: kubectl apply -f sealed-postgres-secret.yaml
#
# Generated sealed secrets should replace the encryptedData section below

---
apiVersion: v1
kind: Secret
metadata:
  name: postgres-credentials
  namespace: production
type: Opaque
stringData:
  # Connection string format
  url: "postgresql://appuser:password123@postgres.prod.svc.cluster.local:5432/appdb"

  # Individual components
  host: "postgres.prod.svc.cluster.local"
  port: "5432"
  database: "appdb"
  user: "appuser"
  password: "password123"

  # Optional: SSL mode
  sslmode: "require"

---
# After sealing, the above becomes:
#
# apiVersion: bitnami.com/v1alpha1
# kind: SealedSecret
# metadata:
#   name: postgres-credentials
#   namespace: production
# spec:
#   encryptionKey: sealed-secrets-key
#   template:
#     metadata:
#       name: postgres-credentials
#       namespace: production
#     type: Opaque
#   encryptedData:
#     url: AgBvK8xA9K2zN4pQ2R3sT4uV5wX6yZ7aA8bC9dE0f...
#     host: AgCdL2mB7F3sO5rT6uV7wX8yZ9aB0cD1eF2gG3h...
#     port: AgEvM9nC3G4uP6sU7vW8xY9zA1bC2dE3fG4hH5i...
#     database: AgFwN0oD1pE2qF3rG4sH5tI6uJ7vK8wL9xM0y...
#     user: AgGxO1pE2qF3rG4sH5tI6uJ7vK8wL9xM0yN1zO2...
#     password: AgHyP2qF3rG4sH5tI6uJ7vK8wL9xM0yN1zO2a...
#     sslmode: AgIzQ3rG4sH5tI6uJ7vK8wL9xM0yN1zO2aP3b...

---
# Usage in Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-service
  namespace: production
spec:
  replicas: 3
  selector:
    matchLabels:
      app: api-service
  template:
    metadata:
      labels:
        app: api-service
    spec:
      containers:
      - name: api
        image: myapp/api:1.0.0
        env:
        # Option 1: Use full connection string
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: postgres-credentials
              key: url

        # Option 2: Use individual components
        - name: DB_HOST
          valueFrom:
            secretKeyRef:
              name: postgres-credentials
              key: host
        - name: DB_PORT
          valueFrom:
            secretKeyRef:
              name: postgres-credentials
              key: port
        - name: DB_NAME
          valueFrom:
            secretKeyRef:
              name: postgres-credentials
              key: database
        - name: DB_USER
          valueFrom:
            secretKeyRef:
              name: postgres-credentials
              key: user
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: postgres-credentials
              key: password

        ports:
        - containerPort: 3000
        livenessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
